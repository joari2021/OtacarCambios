<h4 class="text-primary text-center">Calcular Envio</h4>

<div class="row mt-3">

    <button class="badge badge-primary text-primary m-auto" type="button" data-toggle="modal" data-target="#exampleModal">Ver Tasas de otros Paises</button>

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-success" id="exampleModalLabel">Tasas de <%=current_user.country%> para envios a:</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="card border-success mb-3 m-auto" style="max-width: 36rem;">

                        <div class="card-header text-success text-center">
                            <% @rates.each do |rate| %>

                            <%if current_user.country === rate.country%>

                            <%@rate = rate%>
                            <%= render "partials/tasas", collection: @rate %>

                            <%end%>
                            <%end%>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>

                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div class="col-6 field text-center">
        <label class="mt-2" for="pais">Enviar a: </label>

    </div>
    <div class="col-6">
        <div class="px-2">
            <select class="custom-select" id="pais" onchange=''>
                <option selected disabled value="">Elige un Pais...</option>
                <%@rates.each do |rate|%>
                <%if rate.country === current_user.country%>

                <%if current_user.country != "Brasil" && rate.rate_brasil != "0,00"%><option value="Brasil">Brasil</option><%end%>
                <%if current_user.country != "Chile" && rate.rate_chile != "0,00"%><option value="Chile">Chile</option><%end%>
                <%if current_user.country != "Ecuador" && rate.rate_ecuador != "0,00"%><option value="Ecuador">Ecuador</option><%end%>
                <%if current_user.country != "Espa単a" && rate.rate_espa単a != "0,00"%><option value="Espa単a">Espa単a</option><%end%>
                <%if current_user.country != "Panama" && rate.rate_panama != "0,00"%><option value="Panama">Panama</option><%end%>
                <%if current_user.country != "Peru" && rate.rate_peru != "0,00"%><option value="Peru">Peru</option><%end%>
                <%if current_user.country != "Portugal" && rate.rate_portugal != "0,00"%><option value="Portugal">Portugal</option><%end%>
                <%if current_user.country != "USA" && rate.rate_usa != "0,00"%><option value="USA">USA</option><%end%>
                <%if current_user.country != "Venezuela" && rate.rate_venezuela != "0,00"%><option value="Venezuela">Venezuela</option><%end%>
                <%end%>
                <%end%>
            </select>
        </div>
    </div>
</div>

<div class="mt-5">
    <div class="row field m-auto text-center">
        <div class="col-6">
            <label>Monto a enviar</label>
            <input type="text" id="montoEnvio" value="0,00" oninput="return inputNumber(event)">
        </div>
        <div class="col-6">
            <label>Monto a recibir</label>
            <input type="text" id="montoRecibir" value="" disabled>
        </div>
    </div>
</div>

<div class="field mt-5 text-center">
    <button class="btn btn-success mb-3" id="botonC">Calcular</button>
    <button class="btn btn-danger mb-3 ml-3" id="boton">Borrar</button>
</div>

    
<script src="/js/vistas/campos-numericos-format.js"></script>
<script>
    var pais = document.querySelector('#pais'),
        botonB = document.querySelector('#boton'),
        botonC = document.querySelector('#botonC'),
        montoEnvio = document.querySelector('#montoEnvio'),
        montoRecibir = document.querySelector('#montoRecibir');

    //Funciones
    var setMontoToRecibir = function () {
        <% @rates.each do |rate| %>

        <%if current_user.country === rate.country%>
        var paisV = pais.value
        switch (paisV) {
            
            <%if current_user.country != "Brasil"%>
            case "Brasil":
                var montoE = parseFloat(montoEnvio.value);
                var valorO = "<%=rate.monto_oferta%>";
                
                console.log(valorO.replace(".",""));
                var montoOferta = parseFloat(valorO);
                console.log(montoOferta);
               
                break;
            <%end%>
            
        }
         <%end%>
        <%end%>
    }; 

    pais.addEventListener('change', setMontoToRecibir);

    montoEnvio.addEventListener("focus", function () {
         montoRecibir.value = "";
    });

    botonC.addEventListener('click', setMontoToRecibir);

    botonB.addEventListener('click', function() {
        pais.value = "";
        montoEnvio.value = "";
        montoRecibir.value = "";

    });

    function format(input) {
        input.value = "";
    }
</script>