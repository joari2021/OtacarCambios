<%= form_with(model: rate, local: true) do |form| %>
<% if rate.errors.any? %>
<div id="error_explanation">
    <h2><%= pluralize(rate.errors.count, "error") %> prohibited this rate from being saved:</h2>

    <ul>
        <% rate.errors.full_messages.each do |message| %>
        <li><%= message %></li>
        <% end %>
    </ul>
</div>
<% end %>

<div class="row field">
    <%if @digit === 0%>
    <div class="col-4">
        <%= form.label :country, "Pais", required: :required %>
        <%= form.text_field :country, id:"input", required: :required, class:"text-capitalize" %>
    </div>
    <%else%>
    <div class="col-4">
        <%= form.label :country, "Pais" %>
        <input class="text-capitalize" id="rate_country" value="<%if rate.country.capitalize === "Usa"%><%=rate.country.upcase%><%else%><%=rate.country.capitalize%><%end%> " readonly>
    </div>
    <%end%>

    <div class="col-4">
        <%= form.label :monto_oferta, "Monto Oferta" %>
        <%= form.text_field :monto_oferta, id:"montoOferta"%>

    </div>

    <div class="col-4">
        <%= form.label :moneda, "Moneda", required: :required %>
        <%= form.text_field :moneda, id:"moneda", required: :required %>
    </div>
</div>

<%if @digit === 0 || rate.country.capitalize != "Brasil"%>
<div class="" id="Brasil">
    <h3 class="mt-3 text-success">Brasil</h3>
    <div class="row field">

        <div class="col-6">
            <%= form.label :rate_brasil, "Sin tasa minima" %>
            <%= form.text_field :rate_brasil, required: :required, oninput:"return inputNumber(event)"%>
        </div>

        <div class="col-6">
            <%= form.label :rate_brasil_min, "A partir de" %><span class="text-primary font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%= rate.monto_oferta %> <%end%></span><span class="text-primary  font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%=rate.moneda%><%end%></span>
            <%= form.text_field :rate_brasil_min, oninput:"return inputNumber(event)" %>
        </div>
    </div>
</div>
<%end%>

<%if @digit === 0 || rate.country.capitalize != "Chile"%>
<div class="" id="Chile">
    <h3 class="mt-3 text-success">Chile</h3>
    <div class="row field">

        <div class="col-6">
            <%= form.label :rate_chile, "Sin tasa minima" %>
            <%= form.text_field :rate_chile, required: :required, oninput:"return inputNumber(event)"%>
        </div>

        <div class="col-6">
            <%= form.label :rate_chile_min, "A partir de" %><span class="text-primary font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%= rate.monto_oferta %> <%end%></span><span class="text-primary  font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%=rate.moneda%><%end%></span>
            <%= form.text_field :rate_chile_min, oninput:"return inputNumber(event)" %>
        </div>
    </div>
</div>
<%end%>

<%if @digit === 0 || rate.country.capitalize != "Ecuador"%>
<div class="" id="Ecuador">
    <h3 class="mt-3 text-success">Ecuador</h3>
    <div class="row field">

        <div class="col-6">
            <%= form.label :rate_ecuador, "Sin tasa minima" %>
            <%= form.text_field :rate_ecuador, required: :required, oninput:"return inputNumber(event)"%>
        </div>

        <div class="col-6">
            <%= form.label :rate_ecuador_min, "A partir de" %><span class="text-primary font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%= rate.monto_oferta %> <%end%></span><span class="text-primary  font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%=rate.moneda%><%end%></span>
            <%= form.text_field :rate_ecuador_min, oninput:"return inputNumber(event)" %>
        </div>
    </div>
</div>
<%end%>

<%if @digit === 0 || rate.country.capitalize != "España"%>
<div class="" id="España">
    <h3 class="mt-3 text-success">España</h3>
    <div class="row field">

        <div class="col-6">
            <%= form.label :rate_españa, "Sin tasa minima" %>
            <%= form.text_field :rate_españa, required: :required, oninput:"return inputNumber(event)"%>
        </div>

        <div class="col-6">
            <%= form.label :rate_españa_min, "A partir de" %><span class="text-primary font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%= rate.monto_oferta %> <%end%></span><span class="text-primary  font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%=rate.moneda%><%end%></span>
            <%= form.text_field :rate_españa_min, oninput:"return inputNumber(event)" %>
        </div>
    </div>
</div>
<%end%>

<%if @digit === 0 || rate.country.capitalize != "Panama"%>
<div class="" id="Peru">
    <h3 class="mt-3 text-success">Panama</h3>
    <div class="row field">

        <div class="col-6">
            <%= form.label :rate_panama, "Sin tasa minima" %>
            <%= form.text_field :rate_panama, required: :required, oninput:"return inputNumber(event)"%>
        </div>

        <div class="col-6">
            <%= form.label :rate_panama_min, "A partir de" %><span class="text-primary font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%= rate.monto_oferta %> <%end%></span><span class="text-primary  font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%=rate.moneda%><%end%></span>
            <%= form.text_field :rate_panama_min, oninput:"return inputNumber(event)" %>
        </div>
    </div>
</div>
<%end%>

<%if @digit === 0 || rate.country.capitalize != "Peru"%>
<div class="" id="Peru">
    <h3 class="mt-3 text-success">Peru</h3>
    <div class="row field">

        <div class="col-6">
            <%= form.label :rate_peru, "Sin tasa minima" %>
            <%= form.text_field :rate_peru, required: :required, oninput:"return inputNumber(event)"%>
        </div>

        <div class="col-6">
            <%= form.label :rate_peru_min, "A partir de" %><span class="text-primary font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%= rate.monto_oferta %> <%end%></span><span class="text-primary  font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%=rate.moneda%><%end%></span>
            <%= form.text_field :rate_peru_min, oninput:"return inputNumber(event)" %>
        </div>
    </div>
</div>
<%end%>

<%if @digit === 0 || rate.country.capitalize != "Portugal"%>
<div class="" id="Portugal">
    <h3 class="mt-3 text-success">Portugal</h3>
    <div class="row field">

        <div class="col-6">
            <%= form.label :rate_portugal, "Sin tasa minima" %>
            <%= form.text_field :rate_portugal, required: :required, oninput:"return inputNumber(event)"%>
        </div>

        <div class="col-6">
            <%= form.label :rate_portugal_min, "A partir de" %><span class="text-primary font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%= rate.monto_oferta %> <%end%></span><span class="text-primary  font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%=rate.moneda%><%end%></span>
            <%= form.text_field :rate_portugal_min, oninput:"return inputNumber(event)" %>
            
        </div>
    </div>
</div>
<%end%>

<%if @digit === 0 || rate.country.upcase != "USA"%>
<div class="" id="USA">
    <h3 class="mt-3 text-success">USA</h3>
    <div class="row field">

        <div class="col-6">
            <%= form.label :rate_usa, "Sin tasa minima" %>
            <%= form.text_field :rate_usa, required: :required, oninput:"return inputNumber(event)"%>
            
        </div>

        <div class="col-6">
            <%= form.label :rate_usa_min, "A partir de" %><span class="text-primary font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%= rate.monto_oferta %> <%end%></span><span class="text-primary  font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%=rate.moneda%><%end%></span>
            <%= form.text_field :rate_usa_min, oninput:"return inputNumber(event)" %>
        </div>
    </div>
</div>
<%end%>

<%if @digit === 0 || rate.country.capitalize != "Venezuela"%>
<div class="" id="Venezuela">
    <h3 class="mt-3 text-success">Venezuela</h3>
    <div class="row field">

        <div class="col-6">
            <%= form.label :rate_venezuela, "Sin tasa minima" %>
            <%= form.text_field :rate_venezuela, required: :required, oninput:"return inputNumber(event)"%>
            
        </div>

        <div class="col-6">
            <%= form.label :rate_venezuela_min, "A partir de" %><span class="text-primary font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%= rate.monto_oferta %> <%end%></span><span class="text-primary  font-weight-bold"><%if rate.monto_oferta != "0,00"%> <%=rate.moneda%><%end%></span>
            <%= form.text_field :rate_venezuela_min, oninput:"return inputNumber(event)" %>
        </div>
    </div>
</div>
<%end%>


<div class="actions mt-3">
    <%= form.submit "Guardar", class:"btn btn-success" %>
    <%= link_to 'Volver', :back, class:"btn btn-success float-right"%>
</div>
<% end %>
<script>

    function inputNumber(event) {

        $(event.target).val(function(index, value) {
            
            if (value.length === 0) {
                return "0,00";
            }
            if (value.length === 5) {
                let num = "0123456789";

                if (num.indexOf(value[4]) == -1 && value[3] == "0") {
                    return valor = "0,00";
                } else if (num.indexOf(value[4]) == -1 && value[3] != "0" && value[0] == "0") {
                    let str1 = "0"
                    let str2 = value.slice(1, 4);
                    return str1.concat(str2);
                }
            }
            if (value == "0,0") {
                return valor = "0,00";
            } else if (value.length === 3 && value[0] === "0") {
                let complemento1 = value[2];
                valor = "0,0";
                return valor.concat(complemento1);
            } else if (value.length === 3 && value[0] != "0" && value[2] != "0") {
                let str11 = "0,"
                let str12 = value.replace(",", "");
                return str11.concat(str12);
            } else if (value.length === 3 && value[0] != "0" && value[2] == "0") {
                let string1 = "0,"
                let string2 = value.replace(",", "");
                return string1.concat(string2);
            }
            valor = value.replace(/\D/g, "")
            valor = valor.replace(/([0-9])([0-9]{2})$/, '$1,$2')
            valor = valor.replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");

            if (valor[0] == "0" && valor[1] == "0") {
                let str22 = valor.slice(1);
                return str22;
            } else if (valor[0] == "0" && valor[1] != "0") {
                let str23 = valor.slice(1);
                return str23;
            }

            return valor;

        });

    }
</script>